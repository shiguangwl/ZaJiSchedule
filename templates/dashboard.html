{% extends "base.html" %}

{% block title %}仪表盘 - CPU 智能调度系统{% endblock %}

{% block content %}
<div class="row">
    <div class="col-12">
        <h2><i class="fas fa-tachometer-alt"></i> 系统监控仪表盘</h2>
        <hr>
    </div>
</div>

<!-- 实时指标卡片 -->
<div class="row">
    <div class="col-md-3">
        <div class="card metric-card">
            <div class="metric-label">CPU 使用率</div>
            <div class="metric-value" id="cpuPercent">--</div>
            <small class="text-muted">当前值</small>
        </div>
    </div>

    <div class="col-md-3">
        <div class="card metric-card">
            <div class="metric-label">内存使用率</div>
            <div class="metric-value" id="memoryPercent">--</div>
            <small class="text-muted">当前值</small>
        </div>
    </div>

    <div class="col-md-3">
        <div class="card metric-card">
            <div class="metric-label">滚动窗口平均 CPU</div>
            <div class="metric-value" id="avgCpu">--</div>
            <small class="text-muted">过去 <span id="windowHours">24</span> 小时</small>
        </div>
    </div>

    <div class="col-md-3">
        <div class="card metric-card">
            <div class="metric-label">负载等级</div>
            <div class="metric-value" id="riskLevel">--</div>
            <small class="text-muted">系统状态</small>
        </div>
    </div>
</div>

<!-- 调度器状态 -->
<div class="row">
    <div class="col-md-6">
        <div class="card">
            <div class="card-header bg-primary text-white">
                <i class="fas fa-info-circle"></i> 调度器状态
            </div>
            <div class="card-body">
                <table class="table table-sm">
                    <!-- 核心指标 -->
                    <tr>
                        <td>
                            <strong>当前 CPU 限制</strong>
                            <i class="fas fa-info-circle text-muted" data-bs-toggle="tooltip"
                               title="系统建议的最大CPU使用率，基于配额和安全系数计算出的实际应该限制的值"></i>
                        </td>
                        <td class="text-end"><strong id="safeCpuLimit" class="text-primary">--</strong>%</td>
                    </tr>
                    <tr>
                        <td>
                            <strong>配额余量</strong>
                            <i class="fas fa-info-circle text-muted" data-bs-toggle="tooltip"
                               title="24小时窗口的剩余CPU配额。正数表示有余量，负数表示已超限"></i>
                        </td>
                        <td class="text-end">
                            <strong id="remainingQuota">--</strong>
                            <span id="quotaStatus" class="badge ms-1"></span>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <strong>距离限制</strong>
                            <i class="fas fa-info-circle text-muted" data-bs-toggle="tooltip"
                               title="当前平均CPU与目标限制的差值。正数表示有余量，负数表示已超限"></i>
                        </td>
                        <td class="text-end">
                            <strong id="marginAbsolute">--</strong>%
                            <span id="marginStatus" class="badge ms-1"></span>
                        </td>
                    </tr>

                    <!-- 分隔线 -->
                    <tr><td colspan="2"><hr class="my-2"></td></tr>

                    <!-- 详细信息 -->
                    <tr>
                        <td>
                            目标平均限制
                            <i class="fas fa-info-circle text-muted" data-bs-toggle="tooltip"
                               title="24小时滚动窗口的目标平均CPU使用率"></i>
                        </td>
                        <td class="text-end"><span id="avgLoadLimit">--</span>%</td>
                    </tr>
                    <tr>
                        <td>
                            建议 CPU 使用率
                            <i class="fas fa-info-circle text-muted" data-bs-toggle="tooltip"
                               title="未来时间内建议保持的CPU使用率，以确保不超限"></i>
                        </td>
                        <td class="text-end"><span id="targetCpu">--</span>%</td>
                    </tr>
                </table>

                <!-- 状态说明 -->
                <div id="statusExplanation" class="alert alert-sm mt-3" style="display: none;">
                    <i class="fas fa-lightbulb"></i>
                    <span id="statusText"></span>
                </div>
            </div>
        </div>
    </div>

    <div class="col-md-6">
        <div class="card">
            <div class="card-header bg-success text-white">
                <i class="fas fa-chart-line"></i> 磁盘与网络 I/O
            </div>
            <div class="card-body">
                <table class="table table-sm">
                    <tr>
                        <td>磁盘读取</td>
                        <td class="text-end"><strong id="diskRead">--</strong> MB/s</td>
                    </tr>
                    <tr>
                        <td>磁盘写入</td>
                        <td class="text-end"><strong id="diskWrite">--</strong> MB/s</td>
                    </tr>
                    <tr>
                        <td>网络上传</td>
                        <td class="text-end"><strong id="netSent">--</strong> MB/s</td>
                    </tr>
                    <tr>
                        <td>网络下载</td>
                        <td class="text-end"><strong id="netRecv">--</strong> MB/s</td>
                    </tr>
                </table>
            </div>
        </div>
    </div>
</div>

<!-- 图表 -->
<div class="row">
    <div class="col-md-6">
        <div class="card">
            <div class="card-header">
                <i class="fas fa-chart-area"></i> CPU 使用率趋势
            </div>
            <div class="card-body">
                <div class="chart-container">
                    <canvas id="cpuChart"></canvas>
                </div>
            </div>
        </div>
    </div>

    <div class="col-md-6">
        <div class="card">
            <div class="card-header">
                <i class="fas fa-chart-area"></i> 内存使用率趋势
            </div>
            <div class="card-body">
                <div class="chart-container">
                    <canvas id="memoryChart"></canvas>
                </div>
            </div>
        </div>
    </div>
</div>

{% endblock %}

{% block extra_js %}
<script src="/static/js/dashboard.js"></script>
{% endblock %}
