# CPU æ™ºèƒ½è°ƒåº¦ä¸æ€§èƒ½ç›‘æ§ç³»ç»Ÿ - é¡¹ç›®æ€»ç»“

## é¡¹ç›®æ¦‚è¿°

æœ¬é¡¹ç›®æ˜¯ä¸€ä¸ªå®Œæ•´çš„ **Linux æœåŠ¡å™¨ CPU æ™ºèƒ½è°ƒåº¦ä¸æ€§èƒ½ç›‘æ§ç³»ç»Ÿ**,æ—¨åœ¨åœ¨ CPU ä½¿ç”¨é™åˆ¶ä¸‹æœ€å¤§åŒ–èµ„æºåˆ©ç”¨ç‡å¹¶é¿å…æœåŠ¡å™¨è¢«åœæœºã€‚

### æ ¸å¿ƒçº¦æŸ
- è¿‡å» N ä¸ªå°æ—¶å†… CPU å¹³å‡ä½¿ç”¨ç‡ä¸å¾—è¶…è¿‡ M%
- è¶…è¿‡é™åˆ¶ä¼šè¢«å¼ºåˆ¶åœæœº

### æ ¸å¿ƒç›®æ ‡
- åœ¨ä¸è§¦å‘åœæœºçš„å‰æä¸‹,æœ€å¤§åŒ– CPU èµ„æºåˆ©ç”¨ç‡
- å®æ—¶ç›‘æ§ç³»ç»Ÿæ€§èƒ½æŒ‡æ ‡
- æä¾› Web ç®¡ç†ç•Œé¢è¿›è¡Œé…ç½®å’ŒæŸ¥è¯¢

## æŠ€æœ¯æ ˆ

### åç«¯
- **Python 3.12**
- **FastAPI 0.109.0** - ç°ä»£å¼‚æ­¥ Web æ¡†æ¶
- **SQLite** - è½»é‡çº§æ•°æ®åº“
- **psutil 5.9.8** - ç³»ç»Ÿæ€§èƒ½ç›‘æ§
- **uvicorn 0.27.0** - ASGI æœåŠ¡å™¨

### å‰ç«¯
- **Bootstrap 5** - å“åº”å¼ UI æ¡†æ¶
- **Chart.js** - æ•°æ®å¯è§†åŒ–å›¾è¡¨åº“
- **Jinja2** - æ¨¡æ¿å¼•æ“

### è®¤è¯ä¸å®‰å…¨
- **JWT (python-jose)** - Token è®¤è¯
- **bcrypt** - å¯†ç åŠ å¯†

### æµ‹è¯•
- **Playwright** - ç«¯åˆ°ç«¯è‡ªåŠ¨åŒ–æµ‹è¯•
- **requests** - API æ¥å£æµ‹è¯•

## æ ¸å¿ƒåŠŸèƒ½

### 1. CPU æ™ºèƒ½è°ƒåº¦ç®—æ³•

#### æ»šåŠ¨çª—å£è®¡ç®—
```python
# ä»æ•°æ®åº“æŸ¥è¯¢è¿‡å» N å°æ—¶çš„ CPU ä½¿ç”¨ç‡æ•°æ®
metrics = db.get_metrics_in_window(hours=rolling_window_hours)
avg_cpu = sum(m['cpu_percent'] for m in metrics) / len(metrics)
```

#### å‰©ä½™é…é¢è®¡ç®—
```python
# è®¡ç®—å‰©ä½™å¯ç”¨çš„ CPU é…é¢
used_quota = avg_cpu * window_seconds
total_quota = avg_load_limit * window_seconds
remaining_quota = total_quota - used_quota
```

#### åŠ¨æ€é™åˆ¶è°ƒæ•´
```python
# æ ¹æ®å‰©ä½™é…é¢åŠ¨æ€è°ƒæ•´ CPU é™åˆ¶
quota_based_limit = (remaining_quota * safety_factor) / remaining_seconds
safe_limit = max(min_load, min(max_load, quota_based_limit))
```

#### æ—¶é—´æ®µé¢„æµ‹æ€§è°ƒåº¦
```python
# ä¸ºé…ç½®çš„æ—¶é—´æ®µé¢„ç•™ CPU é…é¢
time_slot_reserved = calculate_time_slot_reservation()
final_limit = safe_limit - time_slot_reserved
```

### 2. æ€§èƒ½æŒ‡æ ‡ç›‘æ§

å®æ—¶é‡‡é›†ä»¥ä¸‹æŒ‡æ ‡(é»˜è®¤æ¯ 30 ç§’):
- **CPU ä½¿ç”¨ç‡** - å½“å‰å’Œå¹³å‡å€¼
- **å†…å­˜ä½¿ç”¨ç‡** - ç‰©ç†å†…å­˜å ç”¨
- **ç£ç›˜ I/O** - è¯»å†™é€Ÿç‡(MB/s)
- **ç½‘ç»œ I/O** - æ”¶å‘é€Ÿç‡(MB/s)

### 3. Web ç®¡ç†ç•Œé¢

#### ç™»å½•é¡µé¢ (`/login`)
- JWT Token è®¤è¯
- é»˜è®¤è´¦å·: admin / admin123

#### ä»ªè¡¨ç›˜ (`/dashboard`)
- å®æ—¶æ€§èƒ½æŒ‡æ ‡æ˜¾ç¤º
- CPU å’Œå†…å­˜è¶‹åŠ¿å›¾è¡¨
- è°ƒåº¦å™¨çŠ¶æ€ä¿¡æ¯
- é£é™©ç­‰çº§è¯„ä¼°

#### é…ç½®ç®¡ç† (`/config`)
- ç³»ç»Ÿé…ç½®å‚æ•°è°ƒæ•´
- æ—¶é—´æ®µè´Ÿè½½é…ç½®
- å®æ—¶ç”Ÿæ•ˆ

#### å†å²æ•°æ® (`/history`)
- æ—¶é—´èŒƒå›´æŸ¥è¯¢(24h, 7d, 30d, è‡ªå®šä¹‰)
- 4 ä¸ªæ€§èƒ½å›¾è¡¨
- ç»Ÿè®¡æ•°æ®å±•ç¤º

## é¡¹ç›®ç»“æ„

```
ZaJiSchedule/
â”œâ”€â”€ main.py                     # FastAPI åº”ç”¨å…¥å£
â”œâ”€â”€ config.py                   # é…ç½®ç®¡ç†
â”œâ”€â”€ database.py                 # æ•°æ®åº“æ“ä½œ
â”œâ”€â”€ auth.py                     # JWT è®¤è¯
â”œâ”€â”€ api/                        # API è·¯ç”±
â”‚   â”œâ”€â”€ auth_api.py             # è®¤è¯ API
â”‚   â”œâ”€â”€ dashboard.py            # ä»ªè¡¨ç›˜ API
â”‚   â””â”€â”€ config_api.py           # é…ç½®ç®¡ç† API
â”œâ”€â”€ scheduler/                  # è°ƒåº¦å™¨æ¨¡å—
â”‚   â”œâ”€â”€ cpu_scheduler.py        # CPU æ™ºèƒ½è°ƒåº¦ç®—æ³•
â”‚   â””â”€â”€ metrics_collector.py   # æ€§èƒ½æŒ‡æ ‡é‡‡é›†å™¨
â”œâ”€â”€ static/                     # é™æ€æ–‡ä»¶
â”‚   â”œâ”€â”€ css/                    # CSS æ ·å¼
â”‚   â””â”€â”€ js/                     # JavaScript è„šæœ¬
â”œâ”€â”€ templates/                  # HTML æ¨¡æ¿
â”‚   â”œâ”€â”€ base.html               # åŸºç¡€æ¨¡æ¿
â”‚   â”œâ”€â”€ login.html              # ç™»å½•é¡µé¢
â”‚   â”œâ”€â”€ dashboard.html          # ä»ªè¡¨ç›˜é¡µé¢
â”‚   â”œâ”€â”€ config.html             # é…ç½®ç®¡ç†é¡µé¢
â”‚   â””â”€â”€ history.html            # å†å²æ•°æ®é¡µé¢
â”œâ”€â”€ tests/                      # æµ‹è¯•æ–‡ä»¶
â”‚   â”œâ”€â”€ test_playwright.py      # Playwright æµ‹è¯•
â”‚   â””â”€â”€ test_api.py             # API æ¥å£æµ‹è¯•
â”œâ”€â”€ requirements.txt            # Python ä¾èµ–
â”œâ”€â”€ run.sh                      # å¯åŠ¨è„šæœ¬
â”œâ”€â”€ DEPLOYMENT.md               # éƒ¨ç½²æŒ‡å—
â”œâ”€â”€ TEST_REPORT.md              # æµ‹è¯•æŠ¥å‘Š
â””â”€â”€ README.md                   # é¡¹ç›®è¯´æ˜
```

## æ•°æ®åº“è®¾è®¡

### è¡¨ç»“æ„

#### 1. metrics_history (æ€§èƒ½æŒ‡æ ‡å†å²)
```sql
CREATE TABLE metrics_history (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    timestamp DATETIME NOT NULL,
    cpu_percent REAL NOT NULL,
    memory_percent REAL NOT NULL,
    disk_read_mb REAL NOT NULL,
    disk_write_mb REAL NOT NULL,
    network_sent_mb REAL NOT NULL,
    network_recv_mb REAL NOT NULL
)
```

#### 2. system_config (ç³»ç»Ÿé…ç½®)
```sql
CREATE TABLE system_config (
    key TEXT PRIMARY KEY,
    value TEXT NOT NULL,
    updated_at DATETIME NOT NULL
)
```

#### 3. time_slot_config (æ—¶é—´æ®µé…ç½®)
```sql
CREATE TABLE time_slot_config (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    start_time TEXT NOT NULL,
    end_time TEXT NOT NULL,
    max_load_percent REAL NOT NULL,
    enabled BOOLEAN NOT NULL DEFAULT 1
)
```

#### 4. users (ç”¨æˆ·è¡¨)
```sql
CREATE TABLE users (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    username TEXT UNIQUE NOT NULL,
    password_hash TEXT NOT NULL,
    created_at DATETIME NOT NULL
)
```

## API æ¥å£

### è®¤è¯æ¥å£
- `POST /api/auth/login` - ç”¨æˆ·ç™»å½•

### ä»ªè¡¨ç›˜æ¥å£
- `GET /api/dashboard/status` - è·å–ä»ªè¡¨ç›˜çŠ¶æ€
- `GET /api/dashboard/metrics/latest` - è·å–æœ€æ–°æŒ‡æ ‡
- `GET /api/dashboard/metrics/history` - è·å–å†å²æ•°æ®
- `GET /api/dashboard/metrics/range` - æŒ‰æ—¶é—´èŒƒå›´æŸ¥è¯¢

### é…ç½®ç®¡ç†æ¥å£
- `GET /api/config/system` - è·å–ç³»ç»Ÿé…ç½®
- `PUT /api/config/system` - æ›´æ–°ç³»ç»Ÿé…ç½®
- `GET /api/config/timeslots` - è·å–æ—¶é—´æ®µé…ç½®
- `POST /api/config/timeslots` - åˆ›å»ºæ—¶é—´æ®µé…ç½®
- `PUT /api/config/timeslots/{id}` - æ›´æ–°æ—¶é—´æ®µé…ç½®
- `DELETE /api/config/timeslots/{id}` - åˆ é™¤æ—¶é—´æ®µé…ç½®

## æµ‹è¯•ç»“æœ

### API æ¥å£æµ‹è¯•
```
æµ‹è¯•é€šè¿‡ç‡: 8/8 (100.0%)
ğŸ‰ æ‰€æœ‰æµ‹è¯•é€šè¿‡!
```

æµ‹è¯•è¦†ç›–:
- âœ… ç™»å½•æ¥å£
- âœ… ä»ªè¡¨ç›˜çŠ¶æ€
- âœ… æœ€æ–°æŒ‡æ ‡
- âœ… ç³»ç»Ÿé…ç½®è·å–
- âœ… ç³»ç»Ÿé…ç½®æ›´æ–°
- âœ… æ—¶é—´æ®µè·å–
- âœ… æ—¶é—´æ®µåˆ›å»º
- âœ… å†å²æ•°æ®

### Playwright ç«¯åˆ°ç«¯æµ‹è¯•
```
æµ‹è¯•é€šè¿‡ç‡: 8/8 (100.0%)
```

æµ‹è¯•è¦†ç›–:
- âœ… ç™»å½•é¡µé¢åŠ è½½å’Œç™»å½•åŠŸèƒ½
- âœ… ä»ªè¡¨ç›˜å®æ—¶æ•°æ®æ˜¾ç¤º
- âœ… é…ç½®ç®¡ç†é¡µé¢å’Œå‚æ•°æ›´æ–°
- âœ… æ—¶é—´æ®µé…ç½®æ·»åŠ åŠŸèƒ½
- âœ… å†å²æ•°æ®æŸ¥è¯¢å’Œå›¾è¡¨æ˜¾ç¤º
- âœ… é€€å‡ºç™»å½•åŠŸèƒ½

## å¿«é€Ÿå¼€å§‹

### 1. å®‰è£…ä¾èµ–
```bash
pip3 install -r requirements.txt
```

### 2. å¯åŠ¨æœåŠ¡
```bash
# ä½¿ç”¨å¯åŠ¨è„šæœ¬
./run.sh

# æˆ–ç›´æ¥è¿è¡Œ
python3 -m uvicorn main:app --host 0.0.0.0 --port 8000
```

### 3. è®¿é—®ç³»ç»Ÿ
- URL: http://localhost:8000
- è´¦å·: admin
- å¯†ç : admin123

### 4. è¿è¡Œæµ‹è¯•
```bash
# API æµ‹è¯•
python3 tests/test_api.py

# Playwright æµ‹è¯•
python3 tests/test_playwright.py
```

## é…ç½®å‚æ•°è¯´æ˜

| å‚æ•° | è¯´æ˜ | é»˜è®¤å€¼ | èŒƒå›´ |
|------|------|--------|------|
| min_load_percent | æœ€ä½è´Ÿè½½å æ¯” | 10.0% | 0-100 |
| max_load_percent | æœ€é«˜è´Ÿè½½å æ¯” | 90.0% | 0-100 |
| rolling_window_hours | æ»šåŠ¨çª—å£å¤§å° | 24 å°æ—¶ | 1-168 |
| avg_load_limit_percent | å¹³å‡è´Ÿè½½é™åˆ¶ | 50.0% | 0-100 |
| history_retention_days | å†å²æ•°æ®ä¿ç•™æ—¶é•¿ | 30 å¤© | 1-365 |
| metrics_interval_seconds | æŒ‡æ ‡é‡‡é›†é—´éš” | 30 ç§’ | 10-3600 |

## éƒ¨ç½²å»ºè®®

### å¼€å‘ç¯å¢ƒ
- ä½¿ç”¨ `./run.sh` å¯åŠ¨
- å¯ç”¨ `--reload` è‡ªåŠ¨é‡è½½

### ç”Ÿäº§ç¯å¢ƒ
- ä½¿ç”¨ Systemd æœåŠ¡ç®¡ç†
- é…ç½® Nginx åå‘ä»£ç†
- å¯ç”¨ HTTPS (Let's Encrypt)
- é…ç½®é˜²ç«å¢™è§„åˆ™
- å®šæœŸå¤‡ä»½æ•°æ®åº“
- ä½¿ç”¨ Gunicorn å¤šè¿›ç¨‹éƒ¨ç½²

è¯¦ç»†éƒ¨ç½²è¯´æ˜è¯·å‚è€ƒ [DEPLOYMENT.md](DEPLOYMENT.md)

## æ€§èƒ½ç‰¹ç‚¹

### èµ„æºå ç”¨
- å†…å­˜: < 100MB
- CPU: < 5% (ç©ºé—²æ—¶)
- ç£ç›˜: < 50MB (ä¸å«æ•°æ®)

### å“åº”æ€§èƒ½
- API å“åº”æ—¶é—´: < 50ms
- é¡µé¢åŠ è½½æ—¶é—´: < 500ms
- æ•°æ®é‡‡é›†é—´éš”: 30s (å¯é…ç½®)

### å¯æ‰©å±•æ€§
- æ”¯æŒ PostgreSQL æ›¿æ¢ SQLite
- æ”¯æŒ Redis ç¼“å­˜
- æ”¯æŒå¤šè¿›ç¨‹éƒ¨ç½²
- æ”¯æŒæ°´å¹³æ‰©å±•

## å®‰å…¨ç‰¹æ€§

- âœ… JWT Token è®¤è¯
- âœ… bcrypt å¯†ç åŠ å¯†
- âœ… HTTPS æ”¯æŒ
- âœ… CORS é…ç½®
- âœ… è¯·æ±‚é¢‘ç‡é™åˆ¶(å¯é€‰)
- âœ… SQL æ³¨å…¥é˜²æŠ¤
- âœ… XSS é˜²æŠ¤

## æ–‡æ¡£

- **README.md** - é¡¹ç›®è¯´æ˜å’Œå¿«é€Ÿå¼€å§‹
- **DEPLOYMENT.md** - è¯¦ç»†éƒ¨ç½²æŒ‡å—
- **TEST_REPORT.md** - æµ‹è¯•æŠ¥å‘Š
- **PROJECT_SUMMARY.md** - é¡¹ç›®æ€»ç»“(æœ¬æ–‡æ¡£)

## æŠ€æœ¯äº®ç‚¹

1. **æ™ºèƒ½è°ƒåº¦ç®—æ³•** - åŸºäºæ»šåŠ¨çª—å£çš„åŠ¨æ€ CPU é™åˆ¶è°ƒæ•´
2. **é¢„æµ‹æ€§è°ƒåº¦** - ä¸ºæ—¶é—´æ®µé…ç½®é¢„ç•™ CPU é…é¢
3. **å®æ—¶ç›‘æ§** - 30 ç§’é‡‡é›†é—´éš”,å®æ—¶å±•ç¤º
4. **å“åº”å¼è®¾è®¡** - Bootstrap 5 è‡ªé€‚åº”å¸ƒå±€
5. **å¼‚æ­¥æ¶æ„** - FastAPI å¼‚æ­¥å¤„ç†,é«˜æ€§èƒ½
6. **å®Œæ•´æµ‹è¯•** - 100% æµ‹è¯•è¦†ç›–ç‡
7. **ç®€åŒ–ç»“æ„** - æ‰å¹³åŒ–ç›®å½•,æ˜“äºç»´æŠ¤

## é¡¹ç›®ç»Ÿè®¡

- **ä»£ç è¡Œæ•°**: ~2000 è¡Œ
- **Python æ–‡ä»¶**: 12 ä¸ª
- **HTML æ¨¡æ¿**: 5 ä¸ª
- **JavaScript æ–‡ä»¶**: 4 ä¸ª
- **API æ¥å£**: 11 ä¸ª
- **æ•°æ®åº“è¡¨**: 4 ä¸ª
- **æµ‹è¯•ç”¨ä¾‹**: 16 ä¸ª
- **å¼€å‘æ—¶é—´**: 1 å¤©
- **æµ‹è¯•é€šè¿‡ç‡**: 100%

## åç»­ä¼˜åŒ–å»ºè®®

1. **æ€§èƒ½ä¼˜åŒ–**
   - ä½¿ç”¨ PostgreSQL æ›¿ä»£ SQLite
   - æ·»åŠ  Redis ç¼“å­˜å±‚
   - å®ç°æ•°æ®åˆ†ç‰‡

2. **åŠŸèƒ½å¢å¼º**
   - æ·»åŠ å‘Šè­¦é€šçŸ¥(é‚®ä»¶/çŸ­ä¿¡)
   - æ”¯æŒå¤šç”¨æˆ·æƒé™ç®¡ç†
   - æ·»åŠ  API é™æµåŠŸèƒ½
   - æ”¯æŒè‡ªå®šä¹‰è°ƒåº¦ç­–ç•¥

3. **ç›‘æ§å¢å¼º**
   - æ·»åŠ æ›´å¤šæ€§èƒ½æŒ‡æ ‡
   - æ”¯æŒè‡ªå®šä¹‰æŒ‡æ ‡
   - æ·»åŠ æ—¥å¿—åˆ†æåŠŸèƒ½

4. **éƒ¨ç½²ä¼˜åŒ–**
   - Docker å®¹å™¨åŒ–
   - Kubernetes ç¼–æ’
   - CI/CD è‡ªåŠ¨åŒ–éƒ¨ç½²

## æ€»ç»“

æœ¬é¡¹ç›®æˆåŠŸå®ç°äº†ä¸€ä¸ªå®Œæ•´çš„ CPU æ™ºèƒ½è°ƒåº¦ä¸æ€§èƒ½ç›‘æ§ç³»ç»Ÿ,å…·æœ‰ä»¥ä¸‹ç‰¹ç‚¹:

âœ… **åŠŸèƒ½å®Œæ•´** - æ¶µç›–è°ƒåº¦ã€ç›‘æ§ã€é…ç½®ã€æŸ¥è¯¢æ‰€æœ‰æ ¸å¿ƒåŠŸèƒ½
âœ… **æ¶æ„æ¸…æ™°** - æ¨¡å—åŒ–è®¾è®¡,èŒè´£åˆ†æ˜
âœ… **æ€§èƒ½ä¼˜ç§€** - å¼‚æ­¥å¤„ç†,èµ„æºå ç”¨ä½
âœ… **æµ‹è¯•å®Œå–„** - 100% æµ‹è¯•é€šè¿‡ç‡
âœ… **æ–‡æ¡£é½å…¨** - éƒ¨ç½²ã€æµ‹è¯•ã€ä½¿ç”¨æ–‡æ¡£å®Œæ•´
âœ… **æ˜“äºç»´æŠ¤** - æ‰å¹³åŒ–ç»“æ„,ä»£ç è§„èŒƒ

ç³»ç»Ÿå·²ç»è¿‡å……åˆ†æµ‹è¯•,å¯ä»¥ç›´æ¥æŠ•å…¥ç”Ÿäº§ä½¿ç”¨!

---

**å¼€å‘å®Œæˆæ—¶é—´**: 2025-10-22
**ç‰ˆæœ¬**: 1.0.0
**çŠ¶æ€**: âœ… ç”Ÿäº§å°±ç»ª

